{% include 'base.html' %}
    <div class="jumbotron">
      <h1 class="display-3">Explore our model</h1>
      <p class="lead">Move the dials below to represent how you feel at work or an employee you care about.</p>
      <p class="lead">We'll tell you the likelyhood they'll leave.</p>

    </div>
    <br>
    Satisfaction level = <span id='satisfaction_level_value'>0</span>
    <br>
    <input type="range" min="0" max="1" step="0.05" value="0" id='satisfaction_level' onchange="moveSlider()">

    <br>
    Average hours worked per month = <span id='average_montly_hours_value'>0</span> hours
    <br>
    <input type="range" min="0" max="500" step="5" value="160" id='average_montly_hours' onchange="moveSlider()">

    <br>
    Last performance evaluation = <span id='last_evaluation_value'>0</span>
    <br>
    <input type="range" min="0" max="1" step="0.05" value="0" id='last_evaluation' onchange="moveSlider()">

    <br>
    Number of projects = <span id='number_project_value'>0</span>
    <br>
    <input type="range" min="0" max="10" step="1" value="0" id='number_project' onchange="moveSlider()">

    <br>
    Years worked at company = <span id='time_spend_company_value'>0</span> years
    <br>
    <input type="range" min="0" max="40" step=".5" value="0" id='time_spend_company' onchange="moveSlider()">

    <br>
    Salary = <span id='salary_value'>0</span>
    <br>
    <input type="range" min="0" max="500000" step="1000" value="0" id='salary' onchange="moveSlider()">


  <!-- stores the most likely result -->
  <div class='jumbotron' id='results'>
  </div>

  <!-- shows the list of all results -->
  <div id='list_results'>
  </div>

</body>
  <!-- include jQuery, so we have access to the $.post function -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <!-- include our own functions -->


  <script>
  function process(){
    //console.log('process func called');

    feature = {
      'satisfaction_level': $('#satisfaction_level').val(),
      'last_evaluation': $('#last_evaluation').val(),
      'number_project':  $('#number_project').val(),
      'average_montly_hours': $('#average_montly_hours').val(),
      'time_spend_company': $('#time_spend_company').val(),
       'Work_accident': 0,
       'promotion_last_5years': 0,
       'IT': 0,
       'RandD': 0,
       'accounting':0,
       'hr':0,
       'management':0,
       'marketing':0,
       'product_mng':0,
       'sales':0,
       'support':0,
       'technical':1,
       'high':0,
       'low':0,
       'medium':0
        }

        if ($('#salary').val() > 100000)
        {
          console.log('high');
          feature.high =1;
          feature.medium =0;
          feature.low =0;
        }
        if ($('#salary').val() < 50000) {
          console.log('low');
          feature.high =0;
          feature.medium =0;
          feature.low =1;
        }
        if (50000 <= $('#salary').val() <= 100000) {
          console.log('medium');
          feature.high =0;
          feature.medium =1;
          feature.low =0;
        }

    // Call our API route /predict_api via the post method
    // Our method returns a dictionary.
    // If successful, pass the dictionary to the function "metis_success"
    // If there is an error, pass the dictionary to the function "metis_error"
    // Note: functions can have any name you want; to demonstrate this we put
    //       metis_ at the beginning of each function.
    //console.log(feature);
    $.post({
      url: '/predict_api',
      contentType: 'application/json',
      data: JSON.stringify(feature),
      success: result => metis_success(result),
      error: result => metis_error(result)
    })
  }

  function ourRound(val, decimalPlaces=1){
    // Javascript rounds to integers by default, so this is a hack
    // to round to a certain number of decimalPlaces
    const factor = Math.pow(10, decimalPlaces)
    return Math.round(factor*val)/factor
  }

  function metis_success(result){
    //alert("inside success");
    $('#results').html(`<p class='lead'>You are ${result*100}% likely to leave</p>`);

    //const all_results = result.all_probs.map( (data) => `${data.name}: ${ourRound(100*data.prob)}`)
    //$('#list_results').html(all_results.join('%<br>') + '%');

    // only included in predictor_javascript_slider_graph.html
    // otherwise does nothing.
    //modifyDivs(result.all_probs);
  }

  function metis_error(result){
    //console.log(result);
    alert("Something's wrong.");
  }

  </script>
  <script>
  function moveSlider(){
    // Just update all the text for all the sliders
    // console.log('inside moveslider');
    const ids = ['satisfaction_level', 'average_montly_hours', 'last_evaluation', 'number_project',
           , 'time_spend_company', 'salary'];
    ids.forEach((id) => {
      const value = $(`#${id}`).val();
      $(`#${id}_value`).html(value);
    });

    // Finally, process the model
    process();
  };
  // function testfunc(){
  //   console.log('inside testfunc');
  //   var test_dict = {
  //     'a':'a',
  //     'satisfaction_level': $('#satisfaction_level').val()
  //   }
  //   console.log(test_dict);
  // };
  </script>
</html>
